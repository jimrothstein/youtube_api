---
title: Template for .Rmd
output: 
  pdf_document:
    latex_engine: xelatex
    toc:  TRUE
    toc_depth:  1
fontsize: 12pt
geometry: margin=0.5in,top=0.25in
#  md_document:
#  html_document:
#    toc: true
#  	toc_float: true
#    css: styles.css
---

pkg_yt_api/exclude/012_playlistitems.Rmd

---- PURPOSE ----
given ONE playlist, return list of videos
----------------

```{r setup, include=FALSE		}
knitr::opts_chunk$set(echo = TRUE,  comment="      ##",  error=TRUE, collapse=TRUE)
```
```{r library, include=FALSE		}
library(jimTools)
library(here)
library(dplyr)
library(magrittr)
load_all()
```

```{r render, eval=FALSE	}
here()
file <- "012_version2_get_all_videos.Rmd"
file  <- basename(file)
dir="rmd"

jimTools::ren_pdf(file,dir)
jimTools::ren_github(file, dir)
```

```{r token}
api  <- get_api_codes()
# set .httr_oauth  and token
myapp  <- tuber::yt_oauth(app_id = api$oauth2_id,
													app_secret = api$oauth2_secret)
```
```{r initialize}
base_url <- "https://www.googleapis.com/youtube/v3/playlistItems"
playlistId <- "PLbcglKxZP5PN07Vw-0ukcDJCxFGY2Crgc "

l <- get_typical_yt()
```

```{r query}
# deprecate yt::set_query
query  <- list(part="snippet",
                maxResults=l$maxResults,
                playlistId=l$playlistId,	
                pageToken="",
                fields=paste(sep=", ", "nextPageToken", 
									"items(snippet(title, description, position))"),
                key=api$api_key)

config  <-  httr::config(token=getOption("google_token"))
```
```{r call}
get_all_videos  <- function(base_url,query,config){

	# first batch	
	r  <- get_batch_videos(base_url, query, config)
	json_content <- get_json(r)
	videos <- json_content$items$snippet

	#if additional batches,  loop
	while ( !is.null(get_nextPageToken(r)) ) {
			query$pageToken  <- get_nextPageToken(r)
			r<- get_batch_videos(base_url, query,config)

			# process
			json_content <- get_json(r)
			next_videos <- json_content$items$snippet
			videos <- rbind(videos, next_videos)

	}	# end loop
	return (videos)
}

# 957 x 3 
videos <- get_all_videos(base_url,query,config)

```
cleanup videos
```{r cleanup}
t  <- videos %>% select(title, position) %>% 
	dplyr::arrange(title)

saveRDS(videos, file=here::here("data/videos.RDS"))
```

```{r knit_exit()}
knitr::knit_exit()
```






